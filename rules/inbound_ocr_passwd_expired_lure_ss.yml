name: "KH_Inbound OCR password expired lure (screenshot)"
description: "Runs OCR on a screenshot of the rendered message and detects password expiration/reset lures."
type: rule
severity: medium

source: |
  type.inbound
  and any(file.explode(file.message_screenshot()),
    strings.ilike(.scan.ocr.raw, "*password*")
    and (
      strings.ilike(.scan.ocr.raw, "*expire*")
      or strings.ilike(.scan.ocr.raw, "*expiration*")
      or strings.ilike(.scan.ocr.raw, "*reset*")
      or strings.ilike(.scan.ocr.raw, "*update*")
    )
  )
