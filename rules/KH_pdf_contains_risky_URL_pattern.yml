name: "Attachment: PDF contains risky URL pattern"
description: "Inbound email has a PDF attachment with embedded URLs that use URL shorteners or suspicious TLDs."
type: rule
severity: medium

source: |
  type.inbound
  and any(attachments,
    (.file_extension == "pdf" or .file_type == "pdf")
    and any(file.explode(.),
      length(.scan.pdf.urls) > 0
      and any(.scan.pdf.urls,
        .domain.root_domain in $url_shorteners
        or .domain.tld in $suspicious_tlds
      )
    )
  )
