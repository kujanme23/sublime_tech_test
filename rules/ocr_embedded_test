name: "KH_Inbound OCR password expired lure"
description: "Inbound email contains an image whose extracted/OCR text suggests a password expiration/reset lure."
type: rule
severity: medium

source: |
  type.inbound
  and any(attachments,
    .file_extension in~ ("png", "jpg", "jpeg")
    and any(file.explode(.),
      any(.scan.strings.strings, strings.icontains(., "password"))
      and (
        any(.scan.strings.strings, strings.icontains(., "expire"))
        or any(.scan.strings.strings, strings.icontains(., "reset"))
        or any(.scan.strings.strings, strings.icontains(., "update"))
      )
    )
  )
